---
import NotebookLayout from '@/layouts/NotebookLayout.astro';
import { extractHeadings } from '@/lib/extract-headings';
import { toPathDate } from '@/lib/utils';
import { getNotebooks, getLatestDate } from '@/lib/data';

export function getStaticPaths() {
  const notebooks = getNotebooks();
  return notebooks.map((nb) => ({
    params: { notebook: nb.id },
  }));
}

const { notebook: notebookId } = Astro.params;
const notebooks = getNotebooks();
const notebook = notebooks.find((nb) => nb.id === notebookId);

if (!notebook) {
  return Astro.redirect('/404');
}

const latestDate = getLatestDate();
// Convert YYYY-MM-DD to YYYY/MM/DD path format
const datePath = toPathDate(latestDate);
const htmlPath = `${datePath}/${notebook.id}.html`;
const headings = extractHeadings(htmlPath);
---

<NotebookLayout title={notebook.title} description={notebook.description} headings={headings} currentDate={latestDate} notebookId={notebook.id} htmlPath={htmlPath} />
