---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Icon from '@/components/Icon.astro';
import { getNotebooks, getLatestDate } from '@/lib/data';
import { formatDisplayDate } from '@/lib/utils';

// Load data
const notebooks = getNotebooks().sort((a, b) => a.order - b.order);
const latestDate = getLatestDate() || 'No data yet';
const base = import.meta.env.BASE_URL;
---

<BaseLayout title="Home">
  <div class="max-w-3xl">
    <!-- Hero Section -->
    <header class="mb-16">
      <div class="text-muted-foreground bg-muted mb-6 inline-flex items-center gap-2 px-3 py-1.5 font-mono text-[0.6875rem] tracking-widest uppercase">
        <span class="bg-accent h-1.5 w-1.5 animate-pulse"></span>
        <span>Updated {latestDate === 'No data yet' ? latestDate : formatDisplayDate(latestDate)}</span>
      </div>
      <h1 class="m-0 mb-6 font-serif text-5xl leading-tight font-normal -tracking-wide max-md:text-4xl">
        <span class="text-foreground block">Ethereum P2P</span>
        <span class="from-primary to-accent block bg-gradient-to-br bg-clip-text text-transparent">Observatory</span>
      </h1>
      <p class="text-muted-foreground max-w-xl text-lg leading-relaxed">
        Real-time insights into Ethereum's peer-to-peer layer. Tracking blob propagation, node connectivity, and network health across the mainnet.
      </p>
    </header>

    <!-- Notebooks Grid -->
    <section class="mb-16">
      <div class="mb-6 flex items-center justify-between">
        <h2 class="m-0 font-serif text-2xl font-normal -tracking-tight">Latest Analyses</h2>
        <span class="text-muted-foreground bg-muted px-2.5 py-1 font-mono text-[0.625rem] tracking-wide uppercase">{notebooks.length} notebooks</span>
      </div>
      <div class="flex flex-col gap-3">
        {
          notebooks.map((nb, index) => (
            <a
              href={`${base}latest/${nb.id}`}
              class="group bg-card border-border hover:border-primary flex items-center gap-4 border p-5 no-underline transition-all duration-200 hover:translate-x-1 hover:shadow-[-4px_0_0_var(--primary)] dark:hover:bg-[oklch(0.16_0.02_260)] dark:hover:shadow-[-4px_0_0_var(--primary),var(--glow)]"
              style={`--index: ${index}`}
            >
              <div class="bg-muted text-muted-foreground group-hover:bg-primary group-hover:text-primary-foreground flex h-10 w-10 shrink-0 items-center justify-center transition-all duration-200">
                <Icon name={nb.icon || 'FileText'} size={20} />
              </div>
              <div class="min-w-0 flex-1">
                <h3 class="text-foreground m-0 mb-1 font-sans text-[0.9375rem] leading-tight font-semibold">{nb.title}</h3>
                <p class="text-muted-foreground m-0 text-[0.8125rem] leading-normal">{nb.description}</p>
              </div>
              <div class="text-muted-foreground group-hover:text-primary -translate-x-2 opacity-0 transition-all duration-200 group-hover:translate-x-0 group-hover:opacity-100">
                <Icon name="ChevronRight" size={16} />
              </div>
            </a>
          ))
        }
      </div>
    </section>
  </div>
</BaseLayout>
