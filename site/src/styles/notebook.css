@reference "./global.css";

.error-container {
  @apply p-10 text-center;
  background: oklch(0.95 0.03 25 / 50%);
  border: 1px solid oklch(0.85 0.08 25);
  color: oklch(0.45 0.15 25);
}

:is(.dark .error-container) {
  background: oklch(0.2 0.05 25 / 30%);
  border-color: oklch(0.4 0.12 25);
  color: oklch(0.75 0.12 25);
}

.error-icon {
  @apply mb-4 inline-flex opacity-70;
}

.error-container h2 {
  @apply mb-2 font-serif text-xl font-normal;
}

.error-container p {
  @apply font-mono text-sm opacity-80;
}

/* Notebook header */
.notebook-header {
  @apply border-border mb-10 border-b pb-8;
}

.notebook-title {
  @apply text-foreground m-0 mb-5 font-serif text-4xl leading-tight font-normal;
}

:is(.dark .notebook-title) {
  background: linear-gradient(135deg, var(--foreground) 0%, var(--mauve-11) 100%);
  @apply bg-clip-text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.notebook-controls {
  @apply flex items-center gap-4;
}

/* Section headings */
.notebook-content h2 {
  @apply text-foreground border-border relative border-b pb-2.5 font-serif font-normal text-[1.625rem] mt-14 mb-6 scroll-mt-14;
}

.notebook-content h2::before {
  @apply bg-primary absolute bottom-[-1px] left-0 h-0.5 w-12;
  content: '';
}

.notebook-content h3 {
  @apply text-foreground font-serif text-xl font-normal mt-10 mb-4 scroll-mt-14;
}

.notebook-content h4 {
  @apply text-foreground font-sans text-base font-semibold mt-8 mb-3;
}

/* Paragraphs and text */
.notebook-content p {
  @apply text-foreground mb-5 mt-0 leading-relaxed;
}

.notebook-content a {
  @apply text-primary no-underline transition-colors duration-200;
}

.notebook-content a:hover {
  @apply text-accent;
}

/* Anchor links on headings - hide text, show pilcrow via ::after on hover */
.notebook-content .anchor-link {
  @apply text-muted-foreground ml-2 no-underline text-[0px];
}

.notebook-content .anchor-link::after {
  content: '¶';
  @apply text-base opacity-0 transition-opacity duration-200;
}

.notebook-content h2:hover .anchor-link::after,
.notebook-content h3:hover .anchor-link::after,
.notebook-content h4:hover .anchor-link::after {
  @apply opacity-50;
}

.notebook-content .anchor-link:hover::after {
  @apply text-primary opacity-100;
}

/* Lists */
.notebook-content ul,
.notebook-content ol {
  @apply mb-5 pl-7 mt-0;
}

.notebook-content li {
  @apply mb-2 leading-loose;
}

.notebook-content li::marker {
  @apply text-primary;
}

/* Cell layouts - default to legible width for text/code, but allow expansion for diagrams */
.notebook-content .cell {
  @apply mx-auto max-w-4xl;
}

/* Exempt cells containing data visualizations */
.notebook-content .cell:has(.js-plotly-plot),
.notebook-content .cell:has(.plotly-graph-div),
.notebook-content .cell:has(.vega-embed),
.notebook-content .cell:has(.sankey) {
  @apply max-w-full;
}

/* Within diagram cells, keep prose/folds narrow while letting only the diagrams expand */
.notebook-content .cell:is(:has(.js-plotly-plot), :has(.plotly-graph-div), :has(.vega-embed), :has(.sankey))>*:not(.output_wrapper, .cell-output-display) {
  @apply mx-auto max-w-4xl;
}

/* Code blocks - nbconvert uses .highlight for syntax highlighting */
.notebook-content .highlight,
.notebook-content .input_area {
  @apply bg-muted relative overflow-x-auto text-[0.8125rem] leading-relaxed;
}

:is(.dark .notebook-content) .highlight,
:is(.dark .notebook-content) .input_area {
  background: oklch(0.14 0.02 260) !important;
}

.notebook-content .highlight pre {
  @apply m-0 bg-transparent px-6 py-5;
}

.notebook-content .highlight code,
.notebook-content .input_area code {
  @apply bg-transparent p-0 font-mono text-sm;
}

/* Pygments token colors - Light mode */
.notebook-content .highlight .k,
.notebook-content .highlight .kn,
.notebook-content .highlight .kd {
  @apply font-medium;
  color: oklch(0.5 0.2 330);
}

/* Keywords */
.notebook-content .highlight .n,
.notebook-content .highlight .nn {
  color: var(--foreground);
}

/* Names */
.notebook-content .highlight .o,
.notebook-content .highlight .p {
  color: var(--foreground);
}

/* Operators, punctuation */
.notebook-content .highlight .s,
.notebook-content .highlight .s1,
.notebook-content .highlight .s2 {
  color: oklch(0.45 0.12 145);
}

/* Strings */
.notebook-content .highlight .mi,
.notebook-content .highlight .mf {
  color: oklch(0.5 0.15 180);
}

/* Numbers */
.notebook-content .highlight .c,
.notebook-content .highlight .c1 {
  @apply text-muted-foreground italic;
}

/* Comments */
.notebook-content .highlight .nb {
  color: oklch(0.45 0.18 260);
}

/* Built-in */
.notebook-content .highlight .nf {
  color: oklch(0.5 0.18 280);
}

/* Function */

/* Dark mode token colors */
:is(.dark .notebook-content) .highlight .k,
:is(.dark .notebook-content) .highlight .kn,
:is(.dark .notebook-content) .highlight .kd {
  color: oklch(0.75 0.18 330);
}

:is(.dark .notebook-content) .highlight .s,
:is(.dark .notebook-content) .highlight .s1,
:is(.dark .notebook-content) .highlight .s2 {
  color: oklch(0.72 0.12 145);
}

:is(.dark .notebook-content) .highlight .mi,
:is(.dark .notebook-content) .highlight .mf {
  color: oklch(0.75 0.14 180);
}

:is(.dark .notebook-content) .highlight .nb {
  color: oklch(0.72 0.15 260);
}

:is(.dark .notebook-content) .highlight .nf {
  color: oklch(0.75 0.15 280);
}

/* Code folding - our custom template uses details.code-fold */
.notebook-content details.code-fold {
  @apply mb-2;
}

.notebook-content details.code-fold>summary {
  @apply text-muted-foreground inline-flex cursor-pointer list-none items-center gap-1.5 border-none bg-transparent p-0 font-mono opacity-60 select-none text-[0.6875rem] transition-colors duration-150;
}

.notebook-content details.code-fold>summary:hover {
  @apply text-foreground opacity-100;
}

.notebook-content details.code-fold>summary::marker,
.notebook-content details.code-fold>summary::-webkit-details-marker {
  @apply hidden;
}

.notebook-content details.code-fold>summary::before {
  content: '▸';
  @apply text-xs transition-transform duration-150;
}

.notebook-content details.code-fold[open]>summary::before {
  @apply rotate-90;
}

.notebook-content details.code-fold[open]>summary {
  @apply mb-2;
}

/* SQL query folding - more prominent than code folding */
.notebook-content details.sql-fold {
  @apply mb-2;
}

.notebook-content details.sql-fold>summary {
  @apply text-primary inline-flex cursor-pointer list-none items-center gap-1.5 border-none bg-transparent p-0 font-mono font-semibold select-none text-[0.6875rem] transition-opacity duration-150;
}

.notebook-content details.sql-fold>summary:hover {
  @apply opacity-80;
}

.notebook-content details.sql-fold>summary::marker,
.notebook-content details.sql-fold>summary::-webkit-details-marker {
  @apply hidden;
}

.notebook-content details.sql-fold>summary::before {
  content: '▸';
  @apply text-xs transition-transform duration-150;
}

.notebook-content details.sql-fold[open]>summary::before {
  @apply rotate-90;
}

.notebook-content details.sql-fold[open]>summary {
  @apply mb-3;
}

/* Remove extra spacing for nested output area */
.notebook-content details.sql-fold .output_wrapper {
  @apply mt-0;
}

.notebook-content details.sql-fold .output_area {
  @apply m-0;
}

/* Charts - Plotly and Altair */
.notebook-content .js-plotly-plot,
.notebook-content .plotly-graph-div {
  @apply my-6 w-full overflow-hidden;
}

.notebook-content .vega-embed {
  @apply my-6 mx-auto w-fit block;
}

/* nbconvert cell structure */
.notebook-content .cell {
  @apply mb-5;
}

.notebook-content .text_cell {
  @apply mb-4;
}

.notebook-content .output_wrapper {
  @apply mt-4;
}

.notebook-content .output_area {
  @apply my-1;
}

/* Reduce gap between contiguous cells containing folds */
.notebook-content .cell:has(details)+.cell:has(details) {
  @apply mt-[-0.5rem];
}

/* Tables */
.notebook-content table {
  @apply border-border my-6 w-full border-collapse overflow-hidden border text-sm;
}

.notebook-content th,
.notebook-content td {
  @apply border-border border-b px-4 py-3 text-left;
}

.notebook-content th {
  @apply bg-muted text-muted-foreground font-mono font-semibold tracking-wider uppercase text-[0.6875rem];
}

.notebook-content td {
  @apply font-mono text-sm;
}

.notebook-content tr:last-child td {
  @apply border-b-0;
}

.notebook-content tr:hover td {
  background: var(--mauve-2);
}

:is(.dark .notebook-content) tr:hover td {
  background: oklch(0.18 0.02 260);
}

/* Blockquotes */
.notebook-content blockquote {
  @apply border-l-primary my-8 border-l-[3px] px-6 py-5;
  background: var(--mauve-2);
}

:is(.dark .notebook-content) blockquote {
  background: oklch(0.16 0.02 260);
}

.notebook-content blockquote p:last-child {
  @apply mb-0;
}

/* Inline code */
.notebook-content :not(pre)>code {
  @apply bg-muted text-primary px-2 py-0.5 font-mono text-[0.875em];
}

:is(.dark .notebook-content) :not(pre)>code {
  background: oklch(0.2 0.02 260);
}

/* Images */
.notebook-content img {
  @apply h-auto max-w-full;
}

/* Horizontal rules */
.notebook-content hr {
  @apply border-border my-12 border-t border-none;
}

/* Hide parameter cells (they have celltag_parameters class) */
.notebook-content .celltag_parameters {
  @apply hidden;
}