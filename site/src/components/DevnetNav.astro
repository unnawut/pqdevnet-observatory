---
// Sticky devnet navigation with prev/next arrows
import Icon from './Icon.astro';

interface Props {
  currentDevnet: string; // e.g., "pqdevnet-005"
  notebookId: string;
  availableDevnets: string[];
}

const { currentDevnet, notebookId, availableDevnets } = Astro.props;

// Derived values
const latestDevnet = availableDevnets[availableDevnets.length - 1]; // Last is latest (sorted ascending)
const isLatest = currentDevnet === latestDevnet;

// Find prev/next devnets (sorted ascending, so prev = lower index)
const currentIndex = availableDevnets.indexOf(currentDevnet);
const prevDevnet = currentIndex > 0 ? availableDevnets[currentIndex - 1] : null;
const nextDevnet = currentIndex < availableDevnets.length - 1 ? availableDevnets[currentIndex + 1] : null;

// Build URLs
const base = import.meta.env.BASE_URL;
const buildUrl = (devnet: string | null) => {
  if (!devnet) return null;
  return `${base}pqdevnet/${devnet}/${notebookId}`;
};

const prevUrl = buildUrl(prevDevnet);
const nextUrl = buildUrl(nextDevnet);

// Format devnet ID for display (e.g., "pqdevnet-005" -> "PQ Devnet 005")
const formatDevnetDisplay = (id: string) => {
  const match = id.match(/pqdevnet-(\d+)/);
  if (match) {
    return `PQ Devnet ${match[1]}`;
  }
  return id;
};
---

<div class="bg-primary sticky top-0 z-40 flex w-full items-center justify-between border-b border-white/10 px-12 py-2 backdrop-blur-xl transition-all max-lg:px-6">
  <a
    href={prevUrl || '#'}
    class:list={[
      'group flex min-w-[90px] items-center justify-start gap-2 px-3.5 py-1.5 text-xs text-white/50 no-underline transition-colors',
      'hover:bg-white/5 hover:text-white',
      { 'pointer-events-none cursor-not-allowed opacity-20': !prevUrl },
    ]}
    aria-label="Previous devnet"
    aria-disabled={!prevUrl}
  >
    <Icon name="ChevronLeft" size={16} />
    {prevDevnet && <span class="hidden font-mono text-[0.625rem] tracking-wide sm:inline">{formatDevnetDisplay(prevDevnet)}</span>}
  </a>

  <div class="flex items-center gap-3">
    <div class="flex items-center gap-1.5 border-r border-white/10 pr-3 font-mono text-[0.625rem] tracking-widest text-white/40 uppercase">
      <Icon name="Box" size={12} />
      <span class="hidden sm:inline">PQ</span>
    </div>
    <div class="flex items-center gap-2.5">
      <span class="font-serif text-[0.9375rem] font-normal -tracking-tight text-white/90">
        {formatDevnetDisplay(currentDevnet)}
      </span>
      {isLatest && <span class="border border-white/20 px-1.5 py-0.5 font-mono text-[0.5625rem] font-semibold tracking-widest text-white/60 uppercase">Latest</span>}
    </div>
  </div>

  <a
    href={nextUrl || '#'}
    class:list={[
      'group flex min-w-[90px] items-center justify-end gap-2 px-3.5 py-1.5 text-xs text-white/50 no-underline transition-colors',
      'hover:bg-white/5 hover:text-white',
      { 'pointer-events-none cursor-not-allowed opacity-20': !nextUrl },
    ]}
    aria-label="Next devnet"
    aria-disabled={!nextUrl}
  >
    {nextDevnet && <span class="hidden font-mono text-[0.625rem] tracking-wide sm:inline">{formatDevnetDisplay(nextDevnet)}</span>}
    <Icon name="ChevronRight" size={16} />
  </a>
</div>
