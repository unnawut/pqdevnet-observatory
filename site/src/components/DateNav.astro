---
// Sticky date navigation with prev/next arrows
import { toPathDate, formatDisplayDate, formatShortDate } from '@/lib/utils';
import Icon from './Icon.astro';

interface Props {
  currentDate: string; // ISO format YYYY-MM-DD
  notebookId: string;
  availableDates: string[];
}

const { currentDate, notebookId, availableDates } = Astro.props;

// Derived values - no slop
const latestDate = availableDates[0];
const isLatest = currentDate === latestDate;

// Find prev/next dates
const currentIndex = availableDates.indexOf(currentDate);
const prevDate = currentIndex < availableDates.length - 1 ? availableDates[currentIndex + 1] : null;
const nextDate = currentIndex > 0 ? availableDates[currentIndex - 1] : null;

// Build URLs - use /latest/ for latest date, /YYYY/MM/DD/ for historical
const base = import.meta.env.BASE_URL;
const buildUrl = (date: string | null) => {
  if (!date) return null;
  if (date === latestDate) {
    return `${base}latest/${notebookId}`;
  }
  return `${base}${toPathDate(date)}/${notebookId}`;
};

const prevUrl = buildUrl(prevDate);
const nextUrl = buildUrl(nextDate);
---

<div class="bg-primary sticky top-0 z-40 flex w-full items-center justify-between border-b border-white/10 px-12 py-2 backdrop-blur-xl transition-all max-lg:px-6">
  <a
    href={prevUrl || '#'}
    class:list={[
      'group flex min-w-[90px] items-center justify-start gap-2 px-3.5 py-1.5 text-xs text-white/50 no-underline transition-colors',
      'hover:bg-white/5 hover:text-white',
      { 'pointer-events-none cursor-not-allowed opacity-20': !prevUrl },
    ]}
    aria-label="Previous date"
    aria-disabled={!prevUrl}
  >
    <Icon name="ChevronLeft" size={16} />
    {prevDate && <span class="hidden font-mono text-[0.625rem] tracking-wide sm:inline">{formatShortDate(prevDate)}</span>}
  </a>

  <div class="flex items-center gap-3">
    <div class="flex items-center gap-1.5 border-r border-white/10 pr-3 font-mono text-[0.625rem] tracking-widest text-white/40 uppercase">
      <Icon name="Calendar" size={12} />
      <span class="hidden sm:inline">Snapshot</span>
    </div>
    <div class="flex items-center gap-2.5">
      <span class="font-serif text-[0.9375rem] font-normal -tracking-tight text-white/90">
        {formatDisplayDate(currentDate)}
      </span>
      {isLatest && <span class="border border-white/20 px-1.5 py-0.5 font-mono text-[0.5625rem] font-semibold tracking-widest text-white/60 uppercase">Latest</span>}
    </div>
  </div>

  <a
    href={nextUrl || '#'}
    class:list={[
      'group flex min-w-[90px] items-center justify-end gap-2 px-3.5 py-1.5 text-xs text-white/50 no-underline transition-colors',
      'hover:bg-white/5 hover:text-white',
      { 'pointer-events-none cursor-not-allowed opacity-20': !nextUrl },
    ]}
    aria-label="Next date"
    aria-disabled={!nextUrl}
  >
    {nextDate && <span class="hidden font-mono text-[0.625rem] tracking-wide sm:inline">{formatShortDate(nextDate)}</span>}
    <Icon name="ChevronRight" size={16} />
  </a>
</div>
